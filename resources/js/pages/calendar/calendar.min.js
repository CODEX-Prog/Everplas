/*!
 * OneUI - v4.3.0
 * @author pixelcave - https://pixelcave.com
 * Copyright (c) 2019
 */
! function (e) {
    var t = {};

    function n(a) {
        if (t[a]) return t[a].exports;
        var r = t[a] = {
            i: a,
            l: !1,
            exports: {}
        };
        return e[a].call(r.exports, r, r.exports, n), r.l = !0, r.exports
    }
    n.m = e, n.c = t, n.d = function (e, t, a) {
        n.o(e, t) || Object.defineProperty(e, t, {
            enumerable: !0,
            get: a
        })
    }, n.r = function (e) {
        "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {
            value: "Module"
        }), Object.defineProperty(e, "__esModule", {
            value: !0
        })
    }, n.t = function (e, t) {
        if (1 & t && (e = n(e)), 8 & t) return e;
        if (4 & t && "object" == typeof e && e && e.__esModule) return e;
        var a = Object.create(null);
        if (n.r(a), Object.defineProperty(a, "default", {
            enumerable: !0,
            value: e
        }), 2 & t && "string" != typeof e)
            for (var r in e) n.d(a, r, function (t) {
                return e[t]
            }.bind(null, r));
        return a
    }, n.n = function (e) {
        var t = e && e.__esModule ? function () {
            return e.default
        } : function () {
            return e
        };
        return n.d(t, "a", t), t
    }, n.o = function (e, t) {
        return Object.prototype.hasOwnProperty.call(e, t)
    }, n.p = "", n(n.s = 0)
}([function (e, t, n) {
    e.exports = n(1)
}, function (e, t) {
    function n(e, t) {
        for (var n = 0; n < t.length; n++) {
            var a = t[n];
            a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a)
        }
    }
    var a = function () {
        function e() {
            ! function (e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }(this, e)
        }
        var t, a, r;
        return t = e, r = [{
            key: "addEvent",
            value: function () {
                var e = this,
                t = jQuery(".js-add-event"),
                n = "";
                jQuery(".js-form-add-event").on("submit", function (a) {
                    console.log('add event form submit: ', a);
                    return (n = t.prop("value")) && (jQuery(".js-events").prepend("<li>" + jQuery("<div />").text(n).html() + "</li>"), t.prop("value", ""), e.initEvents()), !1
                })
            }
        },
        {
            key: "initEvents",
            value: function () {
                jQuery(".js-events").find("li").each(function (e, t) {
                    var n = jQuery(t),
                    a = {
                        title: jQuery.trim(n.text()),
                        color: n.css("background-color")
                    };
                    n.data("eventObject", a),
                    n.draggable({
                        zIndex: 999,
                        revert: !0,
                        revertDuration: 0
                    })
                })
            }
        }, {
                key: "initCalendar",
                value: function () {

                    // get events from Database
                    var events = [];
                    $.ajax({
                        method: "GET",
                        url: "/calendar/events",
                        headers: {
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                        },
                        success: function (response) {
                            var result = JSON.parse(response);
                            if(result['status'] == 'success') {
                                result['events'].map((event, index) => {
                                    var tempEvent = {
                                        id: event['id'],
                                        title: event['title'],
                                        start: new Date(event['start']),
                                        end: new Date(event['end']),
                                        allDay: event['all_day'] == 0? !1 : !0,
                                        url: event['url'],
                                        color: '#' + getRandomColor(),
                                    };
                                    events.push(tempEvent);
                                });
                                jQuery(".js-calendar").fullCalendar({
                                    themeSystem: "bootstrap4",
                                    firstDay: 1,
                                    editable: !0,
                                    droppable: !0,
                                    header: {
                                        left: "title",
                                        right: "prev,next today month,agendaWeek,agendaDay,listWeek"
                                    },

                                    events: events,

                                    drop: function (e, t, n, a) {
                                        var r = jQuery(n.helper);
                                        l = r.data("eventObject");
                                        i = jQuery.extend({}, l);
                                        var self = { ...e};
                                        i.start = e;
                                        i.end = moment(self).add(2, 'hours')
                                        i.allDay = !1;

                                        var data = {
                                            title: i.title,
                                            start: i.start.format('YYYY-MM-DD hh:mm:ss'),
                                            end: i.end.format('YYYY-MM-DD hh:mm:ss'),
                                            allDay: 0
                                        };

                                        $.ajax({
                                            method: "POST",
                                            url: "/calendar/events/create",
                                            data: data,
                                            headers: {
                                                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                            },
                                            success: function (response) {
                                                var result = JSON.parse(response);
                                                if(result['status'] == 'success') {
                                                    i.id = result['event']['id'];
                                                    jQuery(".js-calendar").fullCalendar("renderEvent", i, !1);
                                                    r.remove();
                                                    console.log('here create event success: ', i);
                                                } else {
                                                    console.log("here create event error: ");
                                                }
                                            },
                                            error: function () {
                                                console.log("here create event error: ");
                                            }
                                        });
                                    },

                                    eventDrop: function(eventDropInfo ) {
                                        console.log('event inside the calendar droped: ', eventDropInfo);
                                        var id = eventDropInfo.id;
                                        var start = eventDropInfo.start;
                                        var end = eventDropInfo.end;
                                        var allDay = eventDropInfo.allDay;
                                        if(allDay) {
                                            data = {
                                                id,
                                                allDay: 1,
                                            };
                                        } else {
                                            data = {
                                                id,
                                                start: start.format('YYYY-MM-DD hh:mm:ss'),
                                                end: end.format('YYYY-MM-DD hh:mm:ss'),
                                                allDay: 0,
                                            };
                                        }

                                        $.ajax({
                                            method: "POST",
                                            url: "/calendar/events/update",
                                            data: data,
                                            headers: {
                                                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                            },
                                            success: function (response) {
                                                var result = JSON.parse(response);
                                                if(result['status'] == 'success') {
                                                    console.log('here update event success')
                                                } else {
                                                    console.log("here event error: ");
                                                }
                                            },
                                            error: function () {
                                                console.log("here event error: ");
                                            }
                                        });
                                        console.log('here event update request data: ', data);
                                    },

                                    eventResize: function(eventResizeInfo) {
                                        var id = eventResizeInfo.id;
                                        var start = eventResizeInfo.start;
                                        var end = eventResizeInfo.end;
                                        var allDay = eventResizeInfo.allDay;

                                        var data = {
                                            id,
                                            start: start.format('YYYY-MM-DD hh:mm:ss'),
                                            end: end.format('YYYY-MM-DD hh:mm:ss'),
                                            allDay: 0,
                                        };

                                        $.ajax({
                                            method: "POST",
                                            url: "/calendar/events/update",
                                            data: data,
                                            headers: {
                                                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                            },
                                            success: function (response) {
                                                var result = JSON.parse(response);
                                                if(result['status'] == 'success') {
                                                    console.log('here update event success')
                                                } else {
                                                    console.log("here event error: ");
                                                }
                                            },
                                            error: function () {
                                                console.log("here event error: ");
                                            }
                                        });
                                        console.log('event inside the calendar resized: ', eventResizeInfo);
                                    },
                                });
                                console.log("get events success", events);
                            } else {
                                console.log("get events error: ");
                            }
                        },
                        error: function () {
                            console.log("get events error: ");
                        }
                    });
                }
            }, {
                key: "init",
                value: function () {
                    this.addEvent(), this.initEvents(), this.initCalendar()
                }
            }
        ], (a = null) && n(t.prototype, a), r && n(t, r), e
    }();

    function getRandomColor() {
        return Math.floor(Math.random() * 0xfa00f0);
    };

    function getNextDate(currentDate) {
        var dateArray = currentDate.split('-');
        var nextDate = dateArray[0] + '-' + dateArray[1];
        var day = parseInt(dateArray[2]);
        day = day + 1;
        if (day <= 9) {
            day = '0' + day;
        }
        nextDate = nextDate + '-' + day;
        return nextDate;
    }

    jQuery(function () {
        a.init()
    })
}]);
